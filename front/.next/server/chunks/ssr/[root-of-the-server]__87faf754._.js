module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},5894,(a,b,c)=>{"use strict";b.exports=a.r(18622)},57490,(a,b,c)=>{"use strict";b.exports=a.r(5894).vendored["react-ssr"].ReactJsxRuntime},51413,(a,b,c)=>{"use strict";b.exports=a.r(5894).vendored["react-ssr"].React},70855,a=>{"use strict";function b(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}var c=function a(c,d){function e(a,e,f){if("undefined"!=typeof document){"number"==typeof(f=b({},d,f)).expires&&(f.expires=new Date(Date.now()+864e5*f.expires)),f.expires&&(f.expires=f.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var g="";for(var h in f)f[h]&&(g+="; "+h,!0!==f[h]&&(g+="="+f[h].split(";")[0]));return document.cookie=a+"="+c.write(e,a)+g}}return Object.create({set:e,get:function(a){if("undefined"!=typeof document&&(!arguments.length||a)){for(var b=document.cookie?document.cookie.split("; "):[],d={},e=0;e<b.length;e++){var f=b[e].split("="),g=f.slice(1).join("=");try{var h=decodeURIComponent(f[0]);if(d[h]=c.read(g,h),a===h)break}catch(a){}}return a?d[a]:d}},remove:function(a,c){e(a,"",b({},c,{expires:-1}))},withAttributes:function(c){return a(this.converter,b({},this.attributes,c))},withConverter:function(c){return a(b({},this.converter,c),this.attributes)}},{attributes:{value:Object.freeze(d)},converter:{value:Object.freeze(c)}})}({read:function(a){return'"'===a[0]&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});class d extends Error{status;endpoint;fieldErrors;payload;constructor(a){super(a.message),this.name="ApiError",this.status=a.status,this.endpoint=a.endpoint,this.fieldErrors=a.fieldErrors,this.payload=a.payload}}let e=a=>{let{status:b,endpoint:c,payload:e}=a,j=f(e),k=g(j?.message),l=h(k),m=i({status:b,endpoint:c,rawMessages:k});return new d({status:b,endpoint:c,message:m,fieldErrors:l,payload:e})},f=a=>{if(a&&"object"==typeof a&&("message"in a||"error"in a||"statusCode"in a))return a},g=a=>a?Array.isArray(a)?a.filter(a=>"string"==typeof a):[a]:[],h=a=>{let b={};for(let c of a){let a=c.toLowerCase();if(a.includes("email")){b.email="Введите корректный email";continue}if(a.includes("password")){a.includes("longer")||a.includes("min")?b.password="Пароль должен содержать минимум 8 символов":b.password="Некорректный пароль";continue}}return Object.keys(b).length>0?b:void 0},i=a=>{let{status:b,endpoint:c,rawMessages:d}=a;if(0===b)return"Сервис недоступен. Проверьте, что бэкенд запущен и адрес API указан верно.";if(404===b)return c.startsWith("/auth/")?"Сервис авторизации недоступен или эндпоинт не найден. Проверьте настройки адреса auth API.":"Эндпоинт не найден. Проверьте настройки адреса API.";if("/auth/register"===c){if(409===b)return"Пользователь с таким email уже зарегистрирован.";if(400===b)return"Проверьте корректность email и пароля."}if("/auth/login"===c){if(401===b)return"Неверный email или пароль.";if(400===b)return"Проверьте корректность email и пароля."}if(401===b)return"Требуется авторизация. Войдите в аккаунт заново.";let e=d.map(a=>a.trim()).filter(a=>a.length>0).join(" ");return e||(b>=500?"Ошибка сервера. Попробуйте позже.":"Не удалось выполнить запрос. Попробуйте ещё раз.")},j={api:"NEXT_PUBLIC_API_URL",catalog:"NEXT_PUBLIC_CATALOG_API_URL",auth:"NEXT_PUBLIC_AUTH_API_URL"},k=(a,b)=>{if(!a)throw Error(`Missing ${j[b]}`);return a},l=k("http://localhost:5000","catalog"),m=k("http://localhost:4000","auth"),n="pona_access_token",o="pona_refresh_token",p=async a=>(a.headers.get("content-type")||"").includes("application/json")?a.json().catch(()=>void 0):a.text().catch(()=>void 0),q=new class{catalogBaseUrl;authBaseUrl;constructor(a){this.catalogBaseUrl=a.catalogBaseUrl,this.authBaseUrl=a.authBaseUrl}getAccessToken(){return c.get(n)}getRefreshToken(){return c.get(o)}setTokens(a,b){c.set(n,a,{expires:1}),c.set(o,b,{expires:7})}clearTokens(){c.remove(n),c.remove(o)}async request(a,b={}){let c,f=a.startsWith("/auth/")?this.authBaseUrl:this.catalogBaseUrl,g=`${f}${a}`,h=this.getAccessToken(),i={"Content-Type":"application/json",...b.headers};h&&(i.Authorization=`Bearer ${h}`);try{c=await fetch(g,{...b,headers:i})}catch(b){throw new d({status:0,endpoint:a,message:"Сервис недоступен. Проверьте, что бэкенд запущен и адрес API указан верно.",payload:b})}if(401===c.status){if(await this.refreshAccessToken())return this.request(a,b);throw this.clearTokens(),e({status:401,endpoint:a,payload:await p(c)})}if(!c.ok){let b=await p(c);throw e({status:c.status,endpoint:a,payload:b})}if(204!==c.status)return await p(c)}async refreshAccessToken(){let a=this.getRefreshToken();if(!a)return!1;try{let b=await fetch(`${this.authBaseUrl}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a})});if(!b.ok)return!1;let c=await p(b);if(!c?.accessToken||!c?.refreshToken)return!1;return this.setTokens(c.accessToken,c.refreshToken),!0}catch{return!1}}async login(a){let b=await this.request("/auth/login",{method:"POST",body:JSON.stringify(a)});return this.setTokens(b.accessToken,b.refreshToken),b}async register(a){let b=await this.request("/auth/register",{method:"POST",body:JSON.stringify(a)});return this.setTokens(b.accessToken,b.refreshToken),b}async logout(){try{await this.request("/auth/logout",{method:"POST"})}finally{this.clearTokens()}}async getCurrentUser(){return this.request("/auth/me")}async getProducts(a){let b=new URLSearchParams;a&&Object.entries(a).forEach(([a,c])=>{null!=c&&""!==c&&b.append(a,String(c))});let c=b.toString();return this.request(`/products${c?`?${c}`:""}`)}async getProduct(a){return this.request(`/products/${a}`)}async getProductBySlug(a){return this.request(`/products/slug/${a}`)}async createProduct(a){return this.request("/products",{method:"POST",body:JSON.stringify(a)})}async updateProduct(a,b){return this.request(`/products/${a}`,{method:"PATCH",body:JSON.stringify(b)})}async deleteProduct(a){return this.request(`/products/${a}`,{method:"DELETE"})}async getBrands(){return this.request("/brands")}async getBrand(a){return this.request(`/brands/${a}`)}async createBrand(a){return this.request("/brands",{method:"POST",body:JSON.stringify(a)})}async updateBrand(a,b){return this.request(`/brands/${a}`,{method:"PATCH",body:JSON.stringify(b)})}async deleteBrand(a){return this.request(`/brands/${a}`,{method:"DELETE"})}async getCategories(){return this.request("/categories")}async getCategory(a){return this.request(`/categories/${a}`)}async createCategory(a){return this.request("/categories",{method:"POST",body:JSON.stringify(a)})}async updateCategory(a,b){return this.request(`/categories/${a}`,{method:"PATCH",body:JSON.stringify(b)})}async deleteCategory(a){return this.request(`/categories/${a}`,{method:"DELETE"})}async getUsers(a){let b=new URLSearchParams;a?.page&&b.append("page",String(a.page)),a?.limit&&b.append("limit",String(a.limit)),a?.search&&b.append("search",a.search);let c=b.toString();return this.request(`/auth/admin/users${c?`?${c}`:""}`)}async updateUserRole(a,b){return this.request(`/auth/admin/users/${a}/role`,{method:"PATCH",body:JSON.stringify(b)})}async deactivateUser(a){return this.request(`/auth/admin/users/${a}/deactivate`,{method:"POST"})}async logoutUserAll(a){return this.request(`/auth/admin/users/${a}/logout-all`,{method:"POST"})}isAuthenticated(){return!!this.getAccessToken()}}({catalogBaseUrl:l,authBaseUrl:m});a.s(["apiClient",0,q],70855)},43127,a=>{"use strict";var b=a.i(57490),c=a.i(51413),d=a.i(70855);let e=(0,c.createContext)(void 0),f={CUSTOMER:0,MANAGER:1,ADMIN:2,SUPER_ADMIN:3};function g({children:a}){let[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!0),k=(0,c.useCallback)(async()=>{if(!d.apiClient.isAuthenticated())return void j(!1);try{let a=await d.apiClient.getCurrentUser();h(a)}catch{d.apiClient.clearTokens(),h(null)}finally{j(!1)}},[]);(0,c.useEffect)(()=>{k()},[k]);let l=a=>!!g&&f[g.role]>=f[a],m={user:g,isLoading:i,isAuthenticated:!!g,login:async a=>{h((await d.apiClient.login(a)).user)},register:async a=>{h((await d.apiClient.register(a)).user)},logout:async()=>{await d.apiClient.logout(),h(null)},hasRole:a=>!!g&&(Array.isArray(a)?a:[a]).includes(g.role),isManager:l("MANAGER"),isAdmin:l("ADMIN"),isSuperAdmin:l("SUPER_ADMIN")};return(0,b.jsx)(e.Provider,{value:m,children:a})}function h(){let a=(0,c.useContext)(e);if(void 0===a)throw Error("useAuth must be used within an AuthProvider");return a}a.s(["AuthProvider",()=>g,"useAuth",()=>h])},43814,a=>{"use strict";var b=a.i(57490),c=a.i(87731),d=a.i(91479),e=a.i(6412),f=a.i(33667),g=class extends f.Subscribable{constructor(a={}){super(),this.config=a,this.#a=new Map}#a;build(a,b,e){let f=b.queryKey,g=b.queryHash??(0,c.hashQueryKeyByOptions)(f,b),h=this.get(g);return h||(h=new d.Query({client:a,queryKey:f,queryHash:g,options:a.defaultQueryOptions(b),state:e,defaultOptions:a.getQueryDefaults(f)}),this.add(h)),h}add(a){this.#a.has(a.queryHash)||(this.#a.set(a.queryHash,a),this.notify({type:"added",query:a}))}remove(a){let b=this.#a.get(a.queryHash);b&&(a.destroy(),b===a&&this.#a.delete(a.queryHash),this.notify({type:"removed",query:a}))}clear(){e.notifyManager.batch(()=>{this.getAll().forEach(a=>{this.remove(a)})})}get(a){return this.#a.get(a)}getAll(){return[...this.#a.values()]}find(a){let b={exact:!0,...a};return this.getAll().find(a=>(0,c.matchQuery)(b,a))}findAll(a={}){let b=this.getAll();return Object.keys(a).length>0?b.filter(b=>(0,c.matchQuery)(a,b)):b}notify(a){e.notifyManager.batch(()=>{this.listeners.forEach(b=>{b(a)})})}onFocus(){e.notifyManager.batch(()=>{this.getAll().forEach(a=>{a.onFocus()})})}onOnline(){e.notifyManager.batch(()=>{this.getAll().forEach(a=>{a.onOnline()})})}},h=a.i(65594),i=f,j=class extends i.Subscribable{constructor(a={}){super(),this.config=a,this.#b=new Set,this.#c=new Map,this.#d=0}#b;#c;#d;build(a,b,c){let d=new h.Mutation({client:a,mutationCache:this,mutationId:++this.#d,options:a.defaultMutationOptions(b),state:c});return this.add(d),d}add(a){this.#b.add(a);let b=k(a);if("string"==typeof b){let c=this.#c.get(b);c?c.push(a):this.#c.set(b,[a])}this.notify({type:"added",mutation:a})}remove(a){if(this.#b.delete(a)){let b=k(a);if("string"==typeof b){let c=this.#c.get(b);if(c)if(c.length>1){let b=c.indexOf(a);-1!==b&&c.splice(b,1)}else c[0]===a&&this.#c.delete(b)}}this.notify({type:"removed",mutation:a})}canRun(a){let b=k(a);if("string"!=typeof b)return!0;{let c=this.#c.get(b),d=c?.find(a=>"pending"===a.state.status);return!d||d===a}}runNext(a){let b=k(a);if("string"!=typeof b)return Promise.resolve();{let c=this.#c.get(b)?.find(b=>b!==a&&b.state.isPaused);return c?.continue()??Promise.resolve()}}clear(){e.notifyManager.batch(()=>{this.#b.forEach(a=>{this.notify({type:"removed",mutation:a})}),this.#b.clear(),this.#c.clear()})}getAll(){return Array.from(this.#b)}find(a){let b={exact:!0,...a};return this.getAll().find(a=>(0,c.matchMutation)(b,a))}findAll(a={}){return this.getAll().filter(b=>(0,c.matchMutation)(a,b))}notify(a){e.notifyManager.batch(()=>{this.listeners.forEach(b=>{b(a)})})}resumePausedMutations(){let a=this.getAll().filter(a=>a.state.isPaused);return e.notifyManager.batch(()=>Promise.all(a.map(a=>a.continue().catch(c.noop))))}};function k(a){return a.options.scope?.id}var l=a.i(50237),m=a.i(10848);function n(a){return{onFetch:(b,d)=>{let e=b.options,f=b.fetchOptions?.meta?.fetchMore?.direction,g=b.state.data?.pages||[],h=b.state.data?.pageParams||[],i={pages:[],pageParams:[]},j=0,k=async()=>{let d=!1,k=(0,c.ensureQueryFn)(b.options,b.fetchOptions),l=async(a,e,f)=>{let g;if(d)return Promise.reject();if(null==e&&a.pages.length)return Promise.resolve(a);let h=(g={client:b.client,queryKey:b.queryKey,pageParam:e,direction:f?"backward":"forward",meta:b.options.meta},(0,c.addConsumeAwareSignal)(g,()=>b.signal,()=>d=!0),g),i=await k(h),{maxPages:j}=b.options,l=f?c.addToStart:c.addToEnd;return{pages:l(a.pages,i,j),pageParams:l(a.pageParams,e,j)}};if(f&&g.length){let a="backward"===f,b={pages:g,pageParams:h},c=(a?function(a,{pages:b,pageParams:c}){return b.length>0?a.getPreviousPageParam?.(b[0],b,c[0],c):void 0}:o)(e,b);i=await l(b,c,a)}else{let b=a??g.length;do{let a=0===j?h[0]??e.initialPageParam:o(e,i);if(j>0&&null==a)break;i=await l(i,a),j++}while(j<b)}return i};b.options.persister?b.fetchFn=()=>b.options.persister?.(k,{client:b.client,queryKey:b.queryKey,meta:b.options.meta,signal:b.signal},d):b.fetchFn=k}}}function o(a,{pages:b,pageParams:c}){let d=b.length-1;return b.length>0?a.getNextPageParam(b[d],b,c[d],c):void 0}var p=class{#e;#f;#g;#h;#i;#j;#k;#l;constructor(a={}){this.#e=a.queryCache||new g,this.#f=a.mutationCache||new j,this.#g=a.defaultOptions||{},this.#h=new Map,this.#i=new Map,this.#j=0}mount(){this.#j++,1===this.#j&&(this.#k=l.focusManager.subscribe(async a=>{a&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#l=m.onlineManager.subscribe(async a=>{a&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#j--,0===this.#j&&(this.#k?.(),this.#k=void 0,this.#l?.(),this.#l=void 0)}isFetching(a){return this.#e.findAll({...a,fetchStatus:"fetching"}).length}isMutating(a){return this.#f.findAll({...a,status:"pending"}).length}getQueryData(a){let b=this.defaultQueryOptions({queryKey:a});return this.#e.get(b.queryHash)?.state.data}ensureQueryData(a){let b=this.defaultQueryOptions(a),d=this.#e.build(this,b),e=d.state.data;return void 0===e?this.fetchQuery(a):(a.revalidateIfStale&&d.isStaleByTime((0,c.resolveStaleTime)(b.staleTime,d))&&this.prefetchQuery(b),Promise.resolve(e))}getQueriesData(a){return this.#e.findAll(a).map(({queryKey:a,state:b})=>[a,b.data])}setQueryData(a,b,d){let e=this.defaultQueryOptions({queryKey:a}),f=this.#e.get(e.queryHash),g=f?.state.data,h=(0,c.functionalUpdate)(b,g);if(void 0!==h)return this.#e.build(this,e).setData(h,{...d,manual:!0})}setQueriesData(a,b,c){return e.notifyManager.batch(()=>this.#e.findAll(a).map(({queryKey:a})=>[a,this.setQueryData(a,b,c)]))}getQueryState(a){let b=this.defaultQueryOptions({queryKey:a});return this.#e.get(b.queryHash)?.state}removeQueries(a){let b=this.#e;e.notifyManager.batch(()=>{b.findAll(a).forEach(a=>{b.remove(a)})})}resetQueries(a,b){let c=this.#e;return e.notifyManager.batch(()=>(c.findAll(a).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...a},b)))}cancelQueries(a,b={}){let d={revert:!0,...b};return Promise.all(e.notifyManager.batch(()=>this.#e.findAll(a).map(a=>a.cancel(d)))).then(c.noop).catch(c.noop)}invalidateQueries(a,b={}){return e.notifyManager.batch(()=>(this.#e.findAll(a).forEach(a=>{a.invalidate()}),a?.refetchType==="none")?Promise.resolve():this.refetchQueries({...a,type:a?.refetchType??a?.type??"active"},b))}refetchQueries(a,b={}){let d={...b,cancelRefetch:b.cancelRefetch??!0};return Promise.all(e.notifyManager.batch(()=>this.#e.findAll(a).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let b=a.fetch(void 0,d);return d.throwOnError||(b=b.catch(c.noop)),"paused"===a.state.fetchStatus?Promise.resolve():b}))).then(c.noop)}fetchQuery(a){let b=this.defaultQueryOptions(a);void 0===b.retry&&(b.retry=!1);let d=this.#e.build(this,b);return d.isStaleByTime((0,c.resolveStaleTime)(b.staleTime,d))?d.fetch(b):Promise.resolve(d.state.data)}prefetchQuery(a){return this.fetchQuery(a).then(c.noop).catch(c.noop)}fetchInfiniteQuery(a){return a.behavior=n(a.pages),this.fetchQuery(a)}prefetchInfiniteQuery(a){return this.fetchInfiniteQuery(a).then(c.noop).catch(c.noop)}ensureInfiniteQueryData(a){return a.behavior=n(a.pages),this.ensureQueryData(a)}resumePausedMutations(){return m.onlineManager.isOnline()?this.#f.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#f}getDefaultOptions(){return this.#g}setDefaultOptions(a){this.#g=a}setQueryDefaults(a,b){this.#h.set((0,c.hashKey)(a),{queryKey:a,defaultOptions:b})}getQueryDefaults(a){let b=[...this.#h.values()],d={};return b.forEach(b=>{(0,c.partialMatchKey)(a,b.queryKey)&&Object.assign(d,b.defaultOptions)}),d}setMutationDefaults(a,b){this.#i.set((0,c.hashKey)(a),{mutationKey:a,defaultOptions:b})}getMutationDefaults(a){let b=[...this.#i.values()],d={};return b.forEach(b=>{(0,c.partialMatchKey)(a,b.mutationKey)&&Object.assign(d,b.defaultOptions)}),d}defaultQueryOptions(a){if(a._defaulted)return a;let b={...this.#g.queries,...this.getQueryDefaults(a.queryKey),...a,_defaulted:!0};return b.queryHash||(b.queryHash=(0,c.hashQueryKeyByOptions)(b.queryKey,b)),void 0===b.refetchOnReconnect&&(b.refetchOnReconnect="always"!==b.networkMode),void 0===b.throwOnError&&(b.throwOnError=!!b.suspense),!b.networkMode&&b.persister&&(b.networkMode="offlineFirst"),b.queryFn===c.skipToken&&(b.enabled=!1),b}defaultMutationOptions(a){return a?._defaulted?a:{...this.#g.mutations,...a?.mutationKey&&this.getMutationDefaults(a.mutationKey),...a,_defaulted:!0}}clear(){this.#e.clear(),this.#f.clear()}},q=a.i(83796),r=a.i(51413),s=a.i(43127);function t({children:a}){let[c]=(0,r.useState)(()=>new p({defaultOptions:{queries:{staleTime:6e4,refetchOnWindowFocus:!1,retry:1}}}));return(0,b.jsx)(q.QueryClientProvider,{client:c,children:(0,b.jsx)(s.AuthProvider,{children:a})})}a.s(["Providers",()=>t],43814)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__87faf754._.js.map