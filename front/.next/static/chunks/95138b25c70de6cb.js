(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,83267,e=>{"use strict";var a=e.i(86900),t=e.i(94404),s=e.i(62002);let r=(0,t.cva)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-white shadow hover:bg-primary-dark",secondary:"border-transparent bg-secondary text-white hover:bg-secondary-dark",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-success text-white",warning:"border-transparent bg-warning text-white",info:"border-transparent bg-info text-white"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...l}){return(0,a.jsx)("div",{className:(0,s.cn)(r({variant:t}),e),...l})}e.s(["Badge",()=>l])},80647,e=>{"use strict";let a=(0,e.i(20727).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>a],80647)},96815,e=>{"use strict";let a=(0,e.i(20727).default)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);e.s(["Shield",()=>a],96815)},38925,e=>{"use strict";var a=e.i(86900),t=e.i(91926),s=e.i(62002);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:r,className:(0,s.cn)("w-full caption-bottom text-sm",e),...t})}));r.displayName="Table";let l=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("thead",{ref:r,className:(0,s.cn)("[&_tr]:border-b",e),...t}));l.displayName="TableHeader";let i=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("tbody",{ref:r,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...t}));i.displayName="TableBody",t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("tfoot",{ref:r,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let n=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("tr",{ref:r,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));n.displayName="TableRow";let d=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("th",{ref:r,className:(0,s.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));d.displayName="TableHead";let c=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("td",{ref:r,className:(0,s.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));c.displayName="TableCell",t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("caption",{ref:r,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption",e.s(["Table",()=>r,"TableBody",()=>i,"TableCell",()=>c,"TableHead",()=>d,"TableHeader",()=>l,"TableRow",()=>n])},49839,e=>{"use strict";var a=e.i(86900),t=e.i(91926),s=e.i(29428),r=e.i(86626),l=e.i(80647);let i=(0,e.i(20727).default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var n=e.i(59763),d=e.i(96815),c=e.i(51813),o=e.i(11954),u=e.i(83267),x=e.i(38925),m=e.i(20071),h=e.i(50236),b=e.i(98916),f=e.i(41812),p=e.i(83914),j=e.i(73937),y=e.i(55365),g=e.i(26345);let v={SUPER_ADMIN:{label:"Супер-админ",variant:"destructive"},ADMIN:{label:"Администратор",variant:"default"},MANAGER:{label:"Менеджер",variant:"secondary"},CUSTOMER:{label:"Покупатель",variant:"outline"}},N=["SUPER_ADMIN","ADMIN","MANAGER","CUSTOMER"];function w(){var e;let w,T,C,{isAdmin:M,user:R}=(0,f.useAuth)(),k=(0,s.useRouter)(),[S,A]=(0,t.useState)(""),[D,H]=(0,t.useState)(""),[B,U]=(0,t.useState)(1),{data:E,isLoading:z,error:I}=(e={search:D||void 0,page:B,limit:20},(0,p.useQuery)({queryKey:["users",e],queryFn:()=>g.apiClient.getUsers(e)})),P=(w=(0,y.useQueryClient)(),(0,j.useMutation)({mutationFn:({userId:e,data:a})=>g.apiClient.updateUserRole(e,a),onSuccess:()=>{w.invalidateQueries({queryKey:["users"]})}})),Q=(T=(0,y.useQueryClient)(),(0,j.useMutation)({mutationFn:e=>g.apiClient.deactivateUser(e),onSuccess:()=>{T.invalidateQueries({queryKey:["users"]})}})),q=(C=(0,y.useQueryClient)(),(0,j.useMutation)({mutationFn:e=>g.apiClient.logoutUserAll(e),onSuccess:()=>{C.invalidateQueries({queryKey:["users"]})}}));(0,t.useEffect)(()=>{M||k.push("/admin/dashboard")},[M,k]),(0,t.useEffect)(()=>{let e=setTimeout(()=>{H(S.trim()),U(1)},500);return()=>clearTimeout(e)},[S]);let F=async(e,a)=>{confirm(`Изменить роль пользователя на "${v[a].label}"?`)&&await P.mutateAsync({userId:e,data:{role:a}})},K=async e=>{confirm("Деактивировать пользователя? Он не сможет войти в систему.")&&await Q.mutateAsync(e)},O=async e=>{confirm("Завершить все сессии пользователя?")&&await q.mutateAsync(e)};return M?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Пользователи"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Управление пользователями системы"})]}),(0,a.jsxs)(h.Card,{children:[(0,a.jsx)(h.CardHeader,{className:"pb-4",children:(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,a.jsx)(r.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(o.Input,{placeholder:"Поиск по email...",value:S,onChange:e=>A(e.target.value),className:"pl-10"})]})})}),(0,a.jsx)(h.CardContent,{className:"p-0",children:z?(0,a.jsx)("div",{className:"p-4 space-y-4",children:Array.from({length:5}).map((e,t)=>(0,a.jsx)(b.Skeleton,{className:"h-12 w-full"},t))}):I?(0,a.jsx)("div",{className:"p-8 text-center text-destructive",children:(0,a.jsx)("p",{children:"Ошибка загрузки пользователей"})}):E&&E.users.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(x.Table,{children:[(0,a.jsx)(x.TableHeader,{children:(0,a.jsxs)(x.TableRow,{children:[(0,a.jsx)(x.TableHead,{children:"Email"}),(0,a.jsx)(x.TableHead,{children:"Роль"}),(0,a.jsx)(x.TableHead,{children:"Статус"}),(0,a.jsx)(x.TableHead,{children:"Дата регистрации"}),(0,a.jsx)(x.TableHead,{className:"w-[70px]"})]})}),(0,a.jsx)(x.TableBody,{children:E.users.map(e=>{let t=v[e.role],s=e.id===R?.id;return(0,a.jsxs)(x.TableRow,{children:[(0,a.jsx)(x.TableCell,{children:(0,a.jsxs)("div",{className:"font-medium",children:[e.email,s&&(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:"(вы)"})]})}),(0,a.jsx)(x.TableCell,{children:(0,a.jsx)(u.Badge,{variant:t.variant,children:t.label})}),(0,a.jsx)(x.TableCell,{children:e.isActive?(0,a.jsx)(u.Badge,{variant:"outline",className:"text-green-600 border-green-600",children:"Активен"}):(0,a.jsx)(u.Badge,{variant:"outline",className:"text-red-600 border-red-600",children:"Неактивен"})}),(0,a.jsx)(x.TableCell,{className:"text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}),(0,a.jsx)(x.TableCell,{children:(0,a.jsxs)(m.DropdownMenu,{children:[(0,a.jsx)(m.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",disabled:s,children:(0,a.jsx)(l.MoreHorizontal,{className:"h-4 w-4"})})}),(0,a.jsxs)(m.DropdownMenuContent,{align:"end",children:[(0,a.jsxs)(m.DropdownMenuSub,{children:[(0,a.jsxs)(m.DropdownMenuSubTrigger,{children:[(0,a.jsx)(d.Shield,{className:"mr-2 h-4 w-4"}),"Изменить роль"]}),(0,a.jsx)(m.DropdownMenuSubContent,{children:N.map(t=>(0,a.jsxs)(m.DropdownMenuItem,{onClick:()=>F(e.id,t),disabled:e.role===t,children:[v[t].label,e.role===t&&" ✓"]},t))})]}),(0,a.jsx)(m.DropdownMenuSeparator,{}),(0,a.jsxs)(m.DropdownMenuItem,{onClick:()=>O(e.id),children:[(0,a.jsx)(n.LogOut,{className:"mr-2 h-4 w-4"}),"Завершить все сессии"]}),e.isActive&&(0,a.jsxs)(m.DropdownMenuItem,{onClick:()=>K(e.id),className:"text-destructive",children:[(0,a.jsx)(i,{className:"mr-2 h-4 w-4"}),"Деактивировать"]})]})]})})]},e.id)})})]}),E.totalPages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Страница ",E.page," из ",E.totalPages," (всего ",E.total,")"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>U(e=>Math.max(1,e-1)),disabled:B<=1,children:"Назад"}),(0,a.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>U(e=>Math.min(E.totalPages,e+1)),disabled:B>=E.totalPages,children:"Вперёд"})]})]})]}):(0,a.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:(0,a.jsx)("p",{children:"Пользователи не найдены"})})})]})]}):null}e.s(["default",()=>w],49839)}]);