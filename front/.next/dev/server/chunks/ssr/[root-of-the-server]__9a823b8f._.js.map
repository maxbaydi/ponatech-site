{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/ponatech-site/front/lib/api/errors.ts"],"sourcesContent":["export type ApiFieldErrors = Record<string, string>;\n\ntype NestHttpErrorBody = {\n  statusCode?: number;\n  message?: string | string[];\n  error?: string;\n};\n\nexport class ApiError extends Error {\n  readonly status: number;\n  readonly endpoint: string;\n  readonly fieldErrors?: ApiFieldErrors;\n  readonly payload?: unknown;\n\n  constructor(opts: { status: number; endpoint: string; message: string; fieldErrors?: ApiFieldErrors; payload?: unknown }) {\n    super(opts.message);\n    this.name = 'ApiError';\n    this.status = opts.status;\n    this.endpoint = opts.endpoint;\n    this.fieldErrors = opts.fieldErrors;\n    this.payload = opts.payload;\n  }\n}\n\nexport const isApiError = (error: unknown): error is ApiError => error instanceof ApiError;\n\nexport const toApiError = (opts: { status: number; endpoint: string; payload?: unknown }): ApiError => {\n  const { status, endpoint, payload } = opts;\n  const parsed = parseNestHttpErrorBody(payload);\n  const rawMessages = normalizeNestMessages(parsed?.message);\n  const fieldErrors = deriveFieldErrors(rawMessages);\n  const message = humanizeMessage({ status, endpoint, rawMessages });\n  return new ApiError({ status, endpoint, message, fieldErrors, payload });\n};\n\nconst parseNestHttpErrorBody = (payload: unknown): NestHttpErrorBody | undefined => {\n  if (!payload || typeof payload !== 'object') return undefined;\n  const obj = payload as Partial<NestHttpErrorBody>;\n  if (!('message' in obj) && !('error' in obj) && !('statusCode' in obj)) return undefined;\n  return obj;\n};\n\nconst normalizeNestMessages = (message?: string | string[]): string[] => {\n  if (!message) return [];\n  if (Array.isArray(message)) return message.filter((m): m is string => typeof m === 'string');\n  return [message];\n};\n\nconst deriveFieldErrors = (messages: string[]): ApiFieldErrors | undefined => {\n  const errors: ApiFieldErrors = {};\n\n  for (const msg of messages) {\n    const lower = msg.toLowerCase();\n\n    if (lower.includes('email')) {\n      errors.email = 'Введите корректный email';\n      continue;\n    }\n\n    if (lower.includes('password')) {\n      if (lower.includes('longer') || lower.includes('min')) {\n        errors.password = 'Пароль должен содержать минимум 8 символов';\n      } else {\n        errors.password = 'Некорректный пароль';\n      }\n      continue;\n    }\n  }\n\n  return Object.keys(errors).length > 0 ? errors : undefined;\n};\n\nconst humanizeMessage = (opts: { status: number; endpoint: string; rawMessages: string[] }): string => {\n  const { status, endpoint, rawMessages } = opts;\n\n  if (status === 0) {\n    return 'Сервис недоступен. Проверьте, что бэкенд запущен и адрес API указан верно.';\n  }\n\n  if (status === 404) {\n    if (endpoint.startsWith('/auth/')) {\n      return 'Сервис авторизации недоступен или эндпоинт не найден. Проверьте настройки адреса auth API.';\n    }\n    return 'Эндпоинт не найден. Проверьте настройки адреса API.';\n  }\n\n  if (endpoint === '/auth/register') {\n    if (status === 409) {\n      return 'Пользователь с таким email уже зарегистрирован.';\n    }\n    if (status === 400) {\n      return 'Проверьте корректность email и пароля.';\n    }\n  }\n\n  if (endpoint === '/auth/login') {\n    if (status === 401) {\n      return 'Неверный email или пароль.';\n    }\n    if (status === 400) {\n      return 'Проверьте корректность email и пароля.';\n    }\n  }\n\n  if (status === 401) {\n    return 'Требуется авторизация. Войдите в аккаунт заново.';\n  }\n\n  const joined = rawMessages.map((m) => m.trim()).filter((m) => m.length > 0).join(' ');\n  if (joined) return joined;\n\n  if (status >= 500) {\n    return 'Ошибка сервера. Попробуйте позже.';\n  }\n\n  return 'Не удалось выполнить запрос. Попробуйте ещё раз.';\n};\n"],"names":[],"mappings":";;;;;;;;AAQO,MAAM,iBAAiB;IACnB,OAAe;IACf,SAAiB;IACjB,YAA6B;IAC7B,QAAkB;IAE3B,YAAY,IAA4G,CAAE;QACxH,KAAK,CAAC,KAAK,OAAO;QAClB,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,MAAM,GAAG,KAAK,MAAM;QACzB,IAAI,CAAC,QAAQ,GAAG,KAAK,QAAQ;QAC7B,IAAI,CAAC,WAAW,GAAG,KAAK,WAAW;QACnC,IAAI,CAAC,OAAO,GAAG,KAAK,OAAO;IAC7B;AACF;AAEO,MAAM,aAAa,CAAC,QAAsC,iBAAiB;AAE3E,MAAM,aAAa,CAAC;IACzB,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG;IACtC,MAAM,SAAS,uBAAuB;IACtC,MAAM,cAAc,sBAAsB,QAAQ;IAClD,MAAM,cAAc,kBAAkB;IACtC,MAAM,UAAU,gBAAgB;QAAE;QAAQ;QAAU;IAAY;IAChE,OAAO,IAAI,SAAS;QAAE;QAAQ;QAAU;QAAS;QAAa;IAAQ;AACxE;AAEA,MAAM,yBAAyB,CAAC;IAC9B,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU,OAAO;IACpD,MAAM,MAAM;IACZ,IAAI,CAAC,CAAC,aAAa,GAAG,KAAK,CAAC,CAAC,WAAW,GAAG,KAAK,CAAC,CAAC,gBAAgB,GAAG,GAAG,OAAO;IAC/E,OAAO;AACT;AAEA,MAAM,wBAAwB,CAAC;IAC7B,IAAI,CAAC,SAAS,OAAO,EAAE;IACvB,IAAI,MAAM,OAAO,CAAC,UAAU,OAAO,QAAQ,MAAM,CAAC,CAAC,IAAmB,OAAO,MAAM;IACnF,OAAO;QAAC;KAAQ;AAClB;AAEA,MAAM,oBAAoB,CAAC;IACzB,MAAM,SAAyB,CAAC;IAEhC,KAAK,MAAM,OAAO,SAAU;QAC1B,MAAM,QAAQ,IAAI,WAAW;QAE7B,IAAI,MAAM,QAAQ,CAAC,UAAU;YAC3B,OAAO,KAAK,GAAG;YACf;QACF;QAEA,IAAI,MAAM,QAAQ,CAAC,aAAa;YAC9B,IAAI,MAAM,QAAQ,CAAC,aAAa,MAAM,QAAQ,CAAC,QAAQ;gBACrD,OAAO,QAAQ,GAAG;YACpB,OAAO;gBACL,OAAO,QAAQ,GAAG;YACpB;YACA;QACF;IACF;IAEA,OAAO,OAAO,IAAI,CAAC,QAAQ,MAAM,GAAG,IAAI,SAAS;AACnD;AAEA,MAAM,kBAAkB,CAAC;IACvB,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG;IAE1C,IAAI,WAAW,GAAG;QAChB,OAAO;IACT;IAEA,IAAI,WAAW,KAAK;QAClB,IAAI,SAAS,UAAU,CAAC,WAAW;YACjC,OAAO;QACT;QACA,OAAO;IACT;IAEA,IAAI,aAAa,kBAAkB;QACjC,IAAI,WAAW,KAAK;YAClB,OAAO;QACT;QACA,IAAI,WAAW,KAAK;YAClB,OAAO;QACT;IACF;IAEA,IAAI,aAAa,eAAe;QAC9B,IAAI,WAAW,KAAK;YAClB,OAAO;QACT;QACA,IAAI,WAAW,KAAK;YAClB,OAAO;QACT;IACF;IAEA,IAAI,WAAW,KAAK;QAClB,OAAO;IACT;IAEA,MAAM,SAAS,YAAY,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,GAAG,GAAG,IAAI,CAAC;IACjF,IAAI,QAAQ,OAAO;IAEnB,IAAI,UAAU,KAAK;QACjB,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/ponatech-site/front/lib/api/client.ts"],"sourcesContent":["import Cookies from 'js-cookie';\nimport type {\n  AuthResponse,\n  Brand,\n  Category,\n  CreateBrandRequest,\n  CreateCategoryRequest,\n  CreateProductRequest,\n  LoginRequest,\n  Product,\n  ProductFilters,\n  RegisterRequest,\n  UpdateBrandRequest,\n  UpdateCategoryRequest,\n  UpdateProductRequest,\n  UpdateUserRoleRequest,\n  User,\n  UsersFilters,\n  UsersResponse,\n} from './types';\nimport { ApiError, toApiError } from './errors';\n\nconst ENV_KEYS = {\n  api: 'NEXT_PUBLIC_API_URL',\n  catalog: 'NEXT_PUBLIC_CATALOG_API_URL',\n  auth: 'NEXT_PUBLIC_AUTH_API_URL',\n} as const;\n\nconst NEXT_PUBLIC_API_URL = process.env.NEXT_PUBLIC_API_URL;\nconst NEXT_PUBLIC_CATALOG_API_URL = process.env.NEXT_PUBLIC_CATALOG_API_URL;\nconst NEXT_PUBLIC_AUTH_API_URL = process.env.NEXT_PUBLIC_AUTH_API_URL;\n\nconst getRequiredEnv = (value: string | undefined, key: keyof typeof ENV_KEYS): string => {\n  if (!value) {\n    throw new Error(`Missing ${ENV_KEYS[key]}`);\n  }\n  return value;\n};\n\nconst DEFAULT_CATALOG_API_URL = NEXT_PUBLIC_CATALOG_API_URL || NEXT_PUBLIC_API_URL;\nconst DEFAULT_AUTH_API_URL = NEXT_PUBLIC_AUTH_API_URL;\n\nconst CATALOG_API_URL = getRequiredEnv(DEFAULT_CATALOG_API_URL, 'catalog');\nconst AUTH_API_URL = getRequiredEnv(DEFAULT_AUTH_API_URL, 'auth');\n\nconst ACCESS_TOKEN_KEY = 'pona_access_token';\nconst REFRESH_TOKEN_KEY = 'pona_refresh_token';\n\nclass ApiClient {\n  private catalogBaseUrl: string;\n  private authBaseUrl: string;\n\n  constructor(opts: { catalogBaseUrl: string; authBaseUrl: string }) {\n    this.catalogBaseUrl = opts.catalogBaseUrl;\n    this.authBaseUrl = opts.authBaseUrl;\n  }\n\n  private getAccessToken(): string | undefined {\n    return Cookies.get(ACCESS_TOKEN_KEY);\n  }\n\n  private getRefreshToken(): string | undefined {\n    return Cookies.get(REFRESH_TOKEN_KEY);\n  }\n\n  setTokens(accessToken: string, refreshToken: string): void {\n    Cookies.set(ACCESS_TOKEN_KEY, accessToken, { expires: 1 });\n    Cookies.set(REFRESH_TOKEN_KEY, refreshToken, { expires: 7 });\n  }\n\n  clearTokens(): void {\n    Cookies.remove(ACCESS_TOKEN_KEY);\n    Cookies.remove(REFRESH_TOKEN_KEY);\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const baseUrl = endpoint.startsWith('/auth/') ? this.authBaseUrl : this.catalogBaseUrl;\n    const url = `${baseUrl}${endpoint}`;\n    const accessToken = this.getAccessToken();\n\n    const headers: HeadersInit = {\n      'Content-Type': 'application/json',\n      ...options.headers,\n    };\n\n    if (accessToken) {\n      (headers as Record<string, string>)['Authorization'] = `Bearer ${accessToken}`;\n    }\n\n    let response: Response;\n    try {\n      response = await fetch(url, {\n        ...options,\n        headers,\n      });\n    } catch (error: unknown) {\n      throw new ApiError({\n        status: 0,\n        endpoint,\n        message: 'Сервис недоступен. Проверьте, что бэкенд запущен и адрес API указан верно.',\n        payload: error,\n      });\n    }\n\n    if (response.status === 401) {\n      const refreshed = await this.refreshAccessToken();\n      if (refreshed) {\n        return this.request<T>(endpoint, options);\n      }\n      this.clearTokens();\n      throw toApiError({ status: 401, endpoint, payload: await safeParseResponseBody(response) });\n    }\n\n    if (!response.ok) {\n      const payload = await safeParseResponseBody(response);\n      throw toApiError({ status: response.status, endpoint, payload });\n    }\n\n    if (response.status === 204) {\n      return undefined as T;\n    }\n\n    const payload = await safeParseResponseBody(response);\n    return payload as T;\n  }\n\n  private async refreshAccessToken(): Promise<boolean> {\n    const refreshToken = this.getRefreshToken();\n    if (!refreshToken) return false;\n\n    try {\n      const response = await fetch(`${this.authBaseUrl}/auth/refresh`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ refreshToken }),\n      });\n\n      if (!response.ok) return false;\n\n      const data = (await safeParseResponseBody(response)) as { accessToken: string; refreshToken: string } | undefined;\n      if (!data?.accessToken || !data?.refreshToken) return false;\n      this.setTokens(data.accessToken, data.refreshToken);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async login(data: LoginRequest): Promise<AuthResponse> {\n    const response = await this.request<AuthResponse>('/auth/login', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n    this.setTokens(response.accessToken, response.refreshToken);\n    return response;\n  }\n\n  async register(data: RegisterRequest): Promise<AuthResponse> {\n    const response = await this.request<AuthResponse>('/auth/register', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n    this.setTokens(response.accessToken, response.refreshToken);\n    return response;\n  }\n\n  async logout(): Promise<void> {\n    try {\n      await this.request('/auth/logout', { method: 'POST' });\n    } finally {\n      this.clearTokens();\n    }\n  }\n\n  async getCurrentUser(): Promise<User> {\n    return this.request<User>('/auth/me');\n  }\n\n  async getProducts(filters?: ProductFilters): Promise<Product[]> {\n    const params = new URLSearchParams();\n    if (filters) {\n      Object.entries(filters).forEach(([key, value]) => {\n        if (value !== undefined && value !== null && value !== '') {\n          params.append(key, String(value));\n        }\n      });\n    }\n    const query = params.toString();\n    return this.request<Product[]>(`/products${query ? `?${query}` : ''}`);\n  }\n\n  async getProduct(id: string): Promise<Product> {\n    return this.request<Product>(`/products/${id}`);\n  }\n\n  async getProductBySlug(slug: string): Promise<Product> {\n    return this.request<Product>(`/products/slug/${slug}`);\n  }\n\n  async createProduct(data: CreateProductRequest): Promise<Product> {\n    return this.request<Product>('/products', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateProduct(id: string, data: UpdateProductRequest): Promise<Product> {\n    return this.request<Product>(`/products/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteProduct(id: string): Promise<void> {\n    return this.request<void>(`/products/${id}`, { method: 'DELETE' });\n  }\n\n  async getBrands(): Promise<Brand[]> {\n    return this.request<Brand[]>('/brands');\n  }\n\n  async getBrand(id: string): Promise<Brand> {\n    return this.request<Brand>(`/brands/${id}`);\n  }\n\n  async createBrand(data: CreateBrandRequest): Promise<Brand> {\n    return this.request<Brand>('/brands', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateBrand(id: string, data: UpdateBrandRequest): Promise<Brand> {\n    return this.request<Brand>(`/brands/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteBrand(id: string): Promise<void> {\n    return this.request<void>(`/brands/${id}`, { method: 'DELETE' });\n  }\n\n  async getCategories(): Promise<Category[]> {\n    return this.request<Category[]>('/categories');\n  }\n\n  async getCategory(id: string): Promise<Category> {\n    return this.request<Category>(`/categories/${id}`);\n  }\n\n  async createCategory(data: CreateCategoryRequest): Promise<Category> {\n    return this.request<Category>('/categories', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async updateCategory(id: string, data: UpdateCategoryRequest): Promise<Category> {\n    return this.request<Category>(`/categories/${id}`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deleteCategory(id: string): Promise<void> {\n    return this.request<void>(`/categories/${id}`, { method: 'DELETE' });\n  }\n\n  async getUsers(filters?: UsersFilters): Promise<UsersResponse> {\n    const params = new URLSearchParams();\n    if (filters?.page) params.append('page', String(filters.page));\n    if (filters?.limit) params.append('limit', String(filters.limit));\n    if (filters?.search) params.append('search', filters.search);\n    const query = params.toString();\n    return this.request<UsersResponse>(`/auth/admin/users${query ? `?${query}` : ''}`);\n  }\n\n  async updateUserRole(userId: string, data: UpdateUserRoleRequest): Promise<User> {\n    return this.request<User>(`/auth/admin/users/${userId}/role`, {\n      method: 'PATCH',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async deactivateUser(userId: string): Promise<User> {\n    return this.request<User>(`/auth/admin/users/${userId}/deactivate`, {\n      method: 'POST',\n    });\n  }\n\n  async logoutUserAll(userId: string): Promise<void> {\n    return this.request<void>(`/auth/admin/users/${userId}/logout-all`, {\n      method: 'POST',\n    });\n  }\n\n  isAuthenticated(): boolean {\n    return !!this.getAccessToken();\n  }\n}\n\nconst safeParseResponseBody = async (response: Response): Promise<unknown> => {\n  const contentType = response.headers.get('content-type') || '';\n  if (contentType.includes('application/json')) {\n    return response.json().catch(() => undefined);\n  }\n  return response.text().catch(() => undefined);\n};\n\nexport const apiClient = new ApiClient({ catalogBaseUrl: CATALOG_API_URL, authBaseUrl: AUTH_API_URL });\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 402, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/ponatech-site/front/lib/auth/auth-context.tsx"],"sourcesContent":["'use client';\n\nimport { createContext, useContext, useEffect, useState, useCallback, type ReactNode } from 'react';\nimport { apiClient } from '@/lib/api/client';\nimport type { User, LoginRequest, RegisterRequest, UserRole } from '@/lib/api/types';\n\ninterface AuthContextType {\n  user: User | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  login: (data: LoginRequest) => Promise<void>;\n  register: (data: RegisterRequest) => Promise<void>;\n  logout: () => Promise<void>;\n  hasRole: (roles: UserRole | UserRole[]) => boolean;\n  isManager: boolean;\n  isAdmin: boolean;\n  isSuperAdmin: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nconst ROLE_HIERARCHY: Record<UserRole, number> = {\n  CUSTOMER: 0,\n  MANAGER: 1,\n  ADMIN: 2,\n  SUPER_ADMIN: 3,\n};\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const fetchUser = useCallback(async () => {\n    if (!apiClient.isAuthenticated()) {\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n      const currentUser = await apiClient.getCurrentUser();\n      setUser(currentUser);\n    } catch {\n      apiClient.clearTokens();\n      setUser(null);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchUser();\n  }, [fetchUser]);\n\n  const login = async (data: LoginRequest) => {\n    const response = await apiClient.login(data);\n    setUser(response.user);\n  };\n\n  const register = async (data: RegisterRequest) => {\n    const response = await apiClient.register(data);\n    setUser(response.user);\n  };\n\n  const logout = async () => {\n    await apiClient.logout();\n    setUser(null);\n  };\n\n  const hasRole = (roles: UserRole | UserRole[]): boolean => {\n    if (!user) return false;\n    const rolesArray = Array.isArray(roles) ? roles : [roles];\n    return rolesArray.includes(user.role);\n  };\n\n  const hasMinRole = (minRole: UserRole): boolean => {\n    if (!user) return false;\n    return ROLE_HIERARCHY[user.role] >= ROLE_HIERARCHY[minRole];\n  };\n\n  const value: AuthContextType = {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    login,\n    register,\n    logout,\n    hasRole,\n    isManager: hasMinRole('MANAGER'),\n    isAdmin: hasMinRole('ADMIN'),\n    isSuperAdmin: hasMinRole('SUPER_ADMIN'),\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAmBA,MAAM,4BAAc,IAAA,+NAAa,EAA8B;AAE/D,MAAM,iBAA2C;IAC/C,UAAU;IACV,SAAS;IACT,OAAO;IACP,aAAa;AACf;AAEO,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,0NAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,0NAAQ,EAAC;IAE3C,MAAM,YAAY,IAAA,6NAAW,EAAC;QAC5B,IAAI,CAAC,0IAAS,CAAC,eAAe,IAAI;YAChC,aAAa;YACb;QACF;QAEA,IAAI;YACF,MAAM,cAAc,MAAM,0IAAS,CAAC,cAAc;YAClD,QAAQ;QACV,EAAE,OAAM;YACN,0IAAS,CAAC,WAAW;YACrB,QAAQ;QACV,SAAU;YACR,aAAa;QACf;IACF,GAAG,EAAE;IAEL,IAAA,2NAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAU;IAEd,MAAM,QAAQ,OAAO;QACnB,MAAM,WAAW,MAAM,0IAAS,CAAC,KAAK,CAAC;QACvC,QAAQ,SAAS,IAAI;IACvB;IAEA,MAAM,WAAW,OAAO;QACtB,MAAM,WAAW,MAAM,0IAAS,CAAC,QAAQ,CAAC;QAC1C,QAAQ,SAAS,IAAI;IACvB;IAEA,MAAM,SAAS;QACb,MAAM,0IAAS,CAAC,MAAM;QACtB,QAAQ;IACV;IAEA,MAAM,UAAU,CAAC;QACf,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,aAAa,MAAM,OAAO,CAAC,SAAS,QAAQ;YAAC;SAAM;QACzD,OAAO,WAAW,QAAQ,CAAC,KAAK,IAAI;IACtC;IAEA,MAAM,aAAa,CAAC;QAClB,IAAI,CAAC,MAAM,OAAO;QAClB,OAAO,cAAc,CAAC,KAAK,IAAI,CAAC,IAAI,cAAc,CAAC,QAAQ;IAC7D;IAEA,MAAM,QAAyB;QAC7B;QACA;QACA,iBAAiB,CAAC,CAAC;QACnB;QACA;QACA;QACA;QACA,WAAW,WAAW;QACtB,SAAS,WAAW;QACpB,cAAc,WAAW;IAC3B;IAEA,qBAAO,uPAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAC9C;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,4NAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 500, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/ponatech-site/front/components/providers.tsx"],"sourcesContent":["'use client';\n\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useState, type ReactNode } from 'react';\nimport { AuthProvider } from '@/lib/auth/auth-context';\n\ninterface ProvidersProps {\n  children: ReactNode;\n}\n\nexport function Providers({ children }: ProvidersProps) {\n  const [queryClient] = useState(\n    () =>\n      new QueryClient({\n        defaultOptions: {\n          queries: {\n            staleTime: 60 * 1000,\n            refetchOnWindowFocus: false,\n            retry: 1,\n          },\n        },\n      })\n  );\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>{children}</AuthProvider>\n    </QueryClientProvider>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;AAJA;;;;;AAUO,SAAS,UAAU,EAAE,QAAQ,EAAkB;IACpD,MAAM,CAAC,YAAY,GAAG,IAAA,0NAAQ,EAC5B,IACE,IAAI,qMAAW,CAAC;YACd,gBAAgB;gBACd,SAAS;oBACP,WAAW,KAAK;oBAChB,sBAAsB;oBACtB,OAAO;gBACT;YACF;QACF;IAGJ,qBACE,uPAAC,sNAAmB;QAAC,QAAQ;kBAC3B,cAAA,uPAAC,wJAAY;sBAAE;;;;;;;;;;;AAGrB"}}]
}